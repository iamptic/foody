<!doctype html><html lang="ru"><head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Foody ‚Äî –í–∏—Ç—Ä–∏–Ω–∞</title>
<link rel="stylesheet" href="/web/css/styles.css"/>
<script src="/config.js"></script>
</head><body>
<div class="container">
  <div class="h1">üõí –í–∏—Ç—Ä–∏–Ω–∞</div>
  <div class="section">
    <div class="row">
      <input id="rid" class="input" placeholder="Restaurant ID (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é RID_DEMO)"/>
      <button id="btnLoad" class="btn primary">–ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è</button>
    </div>
  </div>
  <div id="offers" class="grid"></div>
</div>
<script>
const api = window.BACKEND_PUBLIC;
const $ = (s)=>document.querySelector(s);
async function loadOffers(){
  const rid = $('#rid').value.trim() || 'RID_DEMO';
  const res = await fetch(`${api}/api/v1/offers?restaurant_id=${encodeURIComponent(rid)}`);
  const data = await res.json();
  const host = location.origin;
  $('#offers').innerHTML = data.map(o=>`<div class="card">
    <div class="h2">${o.title}</div>
    <div class="small">–î–µ–π—Å—Ç–≤—É–µ—Ç –¥–æ: ${new Date(o.expires_at).toLocaleString()}</div>
    <div class="small">–û—Å—Ç–∞–ª–æ—Å—å: ${o.qty_left}</div>
    <div class="row">
      <div class="btn">${(o.price_cents/100).toFixed(2)} ‚ÇΩ</div>
      <div class="btn success" onclick="reserve('${o.id}')">–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å</div>
    </div>
  </div>`).join('');
}
async function reserve(offerId){
  const buyer_tg_id = (window.Telegram?.WebApp?.initDataUnsafe?.user?.id || 'demo_user')+'';
  const r = await fetch(`${api}/api/v1/reservations`,{
    method:'POST', headers:{'Content-Type':'application/json'},
    body: JSON.stringify({offer_id:offerId,buyer_tg_id})
  });
  const j = await r.json();
  if(r.ok){
    location.href = `/web/buyer/receipt.html?id=${encodeURIComponent(j.id)}`;
  }else{
    alert('–û—à–∏–±–∫–∞: '+(j.detail||r.status));
  }
}
$('#btnLoad').onclick=loadOffers;
loadOffers();
</script>
</body></html>
