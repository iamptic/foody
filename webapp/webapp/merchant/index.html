<!doctype html>
<html><head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Foody — ЛК ресторана</title>
  <script src="/config.js"></script>
  <style>
:root{
  --bg: var(--tg-theme-bg-color, #0f1115);
  --text: var(--tg-theme-text-color, #e6e6e6);
  --subtle: #9aa3b2;
  --card: rgba(255,255,255,0.04);
  --border: rgba(255,255,255,0.12);
  --accent: var(--tg-theme-button-color, #7c5cff);
  --accent-text: var(--tg-theme-button-text-color, #fff);
  --danger: #ff5c5c;
  --ok: #3ecf8e;
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; padding:16px;
  font-family: system-ui,-apple-system,Segoe UI,Roboto,Inter,sans-serif;
  color:var(--text); background:var(--bg);
}
h1,h2,h3{margin:0 0 12px}
.container{max-width:920px;margin:0 auto}
.section{margin:16px 0}
.card{
  background:var(--card); border:1px solid var(--border);
  border-radius:16px; padding:16px;
}
.row{display:flex; gap:12px; align-items:center; flex-wrap:wrap}
.input, select, textarea{
  width:100%; background:#0b0d12; color:var(--text);
  border:1px solid var(--border); border-radius:12px; padding:10px 12px;
}
label{font-size:13px; color:var(--subtle); display:block; margin:6px 0}
.btn{
  display:inline-flex; align-items:center; justify-content:center; gap:8px;
  padding:10px 14px; border-radius:12px; border:1px solid var(--border);
  background:var(--accent); color:var(--accent-text); cursor:pointer;
}
.btn.ghost{ background:transparent; color:var(--text) }
.btn.secondary{ background:#1a1f2b }
.badge{padding:2px 8px;border-radius:999px;border:1px solid var(--border);font-size:12px;color:var(--subtle)}
.grid{display:grid; grid-template-columns:repeat(auto-fill,minmax(240px,1fr)); gap:12px}
.card-item{border-radius:14px; border:1px solid var(--border); background:#0b0d12; padding:12px}
.card-item h3{font-size:16px; margin:0 0 4px}
.empty{opacity:0.7; text-align:center; padding:24px 8px}
.modal{position:fixed; inset:0; display:none; align-items:center; justify-content:center; backdrop-filter: blur(2px); background:rgba(0,0,0,0.4)}
.modal .dialog{width:min(520px,94vw); background:#0b0d12; border:1px solid var(--border); border-radius:16px; padding:16px}
.modal .actions{display:flex; gap:10px; justify-content:flex-end; margin-top:12px}
.table{width:100%; border-collapse:collapse}
.table th,.table td{padding:10px 8px; border-bottom:1px solid var(--border); font-size:14px}
hr{border:none; border-top:1px solid var(--border); margin:12px 0}
.small{font-size:12px; color:var(--subtle)}
</style>
</head>
<body>
<div class="container">
  <h1>Foody</h1>
  <div class="section card">
    <div class="row" style="justify-content:space-between">
      <h2>ЛК ресторана</h2>
      <div class="row"><span class="badge">Статус</span><span class="badge">Проверяем…</span></div>
    </div>
    <div class="card" style="margin-top:12px">
      <h3>Заполните профиль</h3>
      <div class="small">Добавьте телефон, адрес и город — так вас увидят покупатели</div>
      <div class="actions" style="margin-top:10px">
        <button class="btn ghost" onclick="alert('Скоро!')">Заполнить</button>
      </div>
    </div>

    <hr>
    <h3>Новое предложение</h3>
    <div class="row">
      <div style="flex:1">
        <label>Название*</label><input class="input" placeholder="Например: Набор выпечки"/>
      </div>
      <div style="width:160px">
        <label>Цена (₽)*</label><input class="input" type="number" min="1" placeholder="349"/>
      </div>
      <div style="width:160px">
        <label>Количество*</label><input class="input" type="number" min="1" placeholder="5"/>
      </div>
    </div>
    <label>Описание</label><textarea class="input" rows="3" placeholder="Коротко о составе и размерах"></textarea>
    <div class="row">
      <div style="flex:1">
        <label>Действует до</label><input class="input" type="datetime-local"/>
        <div class="small">Локальное время.</div>
      </div>
      <div style="flex:1">
        <label>Фото (опционально)</label>
        <div class="row">
          <input class="input" placeholder="PNG/JPG до 4 МБ" disabled/>
          <button class="btn ghost" onclick="alert('Загрузка появится после офферов')">Загрузить</button>
        </div>
      </div>
    </div>
    <div class="actions">
      <button class="btn">Сохранить</button>
      <button class="btn ghost">Сбросить</button>
    </div>

    <div class="section">
      <h3>Быстрый старт</h3>
      <ol class="small">
        <li>Заполните профиль. Телефон, адрес, город — чтобы вас нашли.</li>
        <li>Добавьте первое предложение. Название, фото, срок действия.</li>
        <li>Держите остаток &gt; 0 — так карточка остаётся в выдаче.</li>
        <li>Фото решает — 3:2 без текста и водяных знаков.</li>
        <li>Чёткие цены — дисконт 40–70% повышает конверсию.</li>
        <li>Время — деньги — ставьте «Действует до» ближе к закрытию.</li>
      </ol>
    </div>

    <div class="section">
      <h3>Мои предложения</h3>
      <div class="empty">Пока пусто. Добавьте первое предложение выше.</div>
    </div>

    <div class="section">
      <h3>Брони</h3>
      <div class="row" style="gap:6px;margin:8px 0">
        <button class="btn ghost small" onclick="loadRes('all')">Все</button>
        <button class="btn ghost small" onclick="loadRes('reserved')">Активные</button>
        <button class="btn ghost small" onclick="loadRes('redeemed')">Погашенные</button>
        <button class="btn ghost small" onclick="loadRes('expired')">Истекшие</button>
      </div>
      <div class="card">
        <table class="table" id="resTable">
          <thead><tr><th>Код</th><th>Оффер</th><th>Покупатель</th><th>Статус</th><th>Действует до</th><th>Создано</th></tr></thead>
          <tbody id="resBody"><tr><td colspan="6" class="small">Загрузите список...</td></tr></tbody>
        </table>
      </div>
    </div>

    <div class="section">
      <h3>Настройки</h3>
      <div class="row" style="align-items:flex-end">
        <div style="flex:1">
          <label>Активный ресторан</label>
          <input class="input" id="rid" value="RID_DEMO"/>
        </div>
        <button class="btn ghost" onclick="alert('Создание ресторана добавим на следующем шаге')">Создать новый ресторан</button>
        <button class="btn">Сохранить</button>
      </div>
    </div>
  </div>
</div>

<script>
  const api = window.BACKEND_PUBLIC || location.origin;
  async function loadRes(filter){
    const rid = document.getElementById('rid').value.trim() || 'RID_DEMO';
    const u = new URL(`${api}/api/v1/reservations`);
    u.searchParams.set('restaurant_id', rid);
    if(filter && filter!=='all') u.searchParams.set('status', filter);
    const r = await fetch(u); const arr = await r.json();
    const tb = document.getElementById('resBody');
    if(!arr.length){ tb.innerHTML = '<tr><td class="small" colspan="6">Броней пока нет</td></tr>'; return; }
    tb.innerHTML = arr.map(x=>`
      <tr>
        <td>${x.code}</td>
        <td>${x.offer_id}</td>
        <td>${x.buyer_tg_id||''}</td>
        <td>${x.status}</td>
        <td>${new Date(x.expires_at).toLocaleString()}</td>
        <td>${new Date().toLocaleString()}</td>
      </tr>
    `).join('');
  }
  loadRes('all').catch(console.error);
</script>
</body></html>
